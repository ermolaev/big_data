# Kafka

```
cd ~/soft
wget http://apache-mirror.rbc.ru/pub/apache/kafka/0.9.0.0/kafka-0.9.0.0-src.tgz
tar xvzf kafka-0.9.0.0-src.tgz
rm -rf kafka-0.9.0.0-src.tgz

cd kafka-0.9.0.0-src/ && gradle && ./gradlew jar
bin/zookeeper-server-start.sh config/zookeeper.properties > zookeeper.log 2>&1 &
bin/kafka-server-start.sh config/server.properties > kafka.log 2>&1 &
bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
```
# Spark
Zinc стратует сразу после любого вызова build/mvn, то есть работает по умолчанию
чтобы проверить на сколько он полезен нужно отключить опцию `<useZincServer>true</useZincServer>`
build/zinc-<version>/bin/zinc -shutdown - отключает, но при запуске build/mvn он опять стратует

```
build/mvn compile
Zinc отключен первый прогон - `Total time: 10:09 min`
Zinc отключен второй прогон - `Total time: 03:42 min`
Zinc включен первый прогон - `Total time: 05:55 min`
Zinc включен второй прогон - `Total time: 01:47 min`
```

- ускорение в 2 раза, второй прогон быстрее первого за счет `<recompileMode>incremental</recompileMode>`
- использует много оперативной памяти, после компиляции нужно его выключать - `shutdown`


```
оригинальный JAR
./bin/spark-submit \
  --master 'local[*]'  \
  --packages org.apache.spark:spark-streaming-kafka_2.10:1.6.0 \
  --class ermolaev.streaming.SimpleKafka \
  /home/ermolaev/big_data/spark1/target/original-streaming-kafka-0.0.1-SNAPSHOT.jar \
  test

супер JAR
./bin/spark-submit \
  --master 'local[*]'  \
  --class ermolaev.streaming.SimpleKafka \
  /home/ermolaev/big_data/spark1/target/streaming-kafka-0.0.1-SNAPSHOT.jar \
  test
```


1. Что такое real time обработка? 2 часа это реалтайм? А 10 секунд? А 10мс? Где граница?

  Зависит от специфики задачи, но нужно исходить из бизнес требований, то есть прикинуть прибыль/убыток бизнеса от задержки обработки, все это конечно определяется экспертно. Например анализ логов веб сервера может устроить задержка на десятки секунд, когда нам нужно сделать мониторинг с какой-нибудь агрегацией событий, а вот если стоят задача определения хакерской активности из тех же логов, тогда, система должна реагировать максимально быстро, или при обработке финансовых транзакций, пользователь не должен ждать что его платеж будеть проверяться минуты и только потом будет подтвржден или отклонен.

2. Как подсчитать максимальную и минимальную задержку между появление сообщения в кафка producer и появлением результат обработки этого сообщения в нашем приложении(терминал, база, распределенная память)?

  У нас в приложении пакетная процессинг, причем пакеты разделяются по времени, в данном случае каждые 10 сек, если сообщение приходит в начале формирования пакета (Максимальное время) - то время попадания сообщения в обработчик будет ~ 10 сек. В случае если сообщение приходит в конец пакета, то есть уже скоро должа запуститься его обратка, время его попадания в обработчик ~ 0 сек. Сама обработка сообщения зависит от логики его обработки и общего кол-ва сообщений в пакете.

3. Почему Kafka быстро компилируется, а Spark долго?

  Spark имеет на пордки большую кодовую базу и кол-во зависимостей.

4. Как перед завершением работы приложения выполнить какой-то код?

  `sys.ShutdownHookThread`

5. Добавьте вывод дополнительной информации как в коде ниже. Что написало приложение?

  `16/02/06 23:53:45 ERROR SimpleKafka$: DEBUG info:localhost:2181`
